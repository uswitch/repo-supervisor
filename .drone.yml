pipeline:
  publish:
    when:
      event: push
      branch: master
    image: plugins/docker
    repo: registry.usw.co/uswitch/repo-supervisor
    tags:
      - latest
      - "${DRONE_COMMIT}"

  deploy:
    when:
      event: push
      branch: master
    image: registry.usw.co/drone/deployment:latest
    secrets: [ KUBE_CLUSTERS, GITHUB_TOKEN, SLACK_WEBHOOK ]
    tag: false
    kubernetes:
      namespace: cloud
      template: kubernetes.yaml
      clusters:
        - black
